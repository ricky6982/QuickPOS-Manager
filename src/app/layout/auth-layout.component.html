<div class="layout-container">
  <mat-toolbar color="primary">
    <div class="toolbar-left">
      <img src="/logo.svg" alt="logo" class="logo" />
      <span class="apptitle">{{ title() }}</span>
    </div>

    <div class="toolbar-right">
      <!-- Badge de Admin -->
      @if (isAdmin()) {
        <mat-chip-option selected style="background-color: #f44336; color: white; margin-right: 16px;">
          <mat-icon style="font-size: 16px; width: 16px; height: 16px; margin-right: 4px;">admin_panel_settings</mat-icon>
          ADMIN
        </mat-chip-option>
      }

      <!-- Selector de Organizadores (solo para admin o modo legado) -->
      @if (isAdmin() || organizers().length > 0) {
        <mat-icon style="margin-right: 8px;">business</mat-icon>
        <mat-form-field appearance="outline" subscriptSizing="dynamic" class="organizer-selector">
          <mat-select
            [value]="selectedOrganizer()"
            (selectionChange)="onOrganizerChange($event.value)">

            <!-- Opción en blanco para deseleccionar -->
            <mat-option [value]="null">
              <em>-- Ninguno --</em>
            </mat-option>

            <!-- Buscador (solo si hay más de 10 organizadores) -->
            @if (showSearch()) {
              <mat-option>
                <ngx-mat-select-search
                  [formControl]="organizerSearchCtrl"
                  placeholderLabel="Buscar ..."
                  noEntriesFoundLabel="No se encontraron organizadores">
                </ngx-mat-select-search>
              </mat-option>
            }

            <!-- Lista de organizadores filtrados -->
            @for (organizer of filteredOrganizers(); track organizer.id) {
              <mat-option [value]="organizer.id">
                {{ organizer.name }}
              </mat-option>
            }
          </mat-select>
        </mat-form-field>
      }

      <!-- Menú de Usuario -->
      @if (username()) {
        <button mat-button [matMenuTriggerFor]="userMenu" class="user-menu-button">
          <mat-icon>account_circle</mat-icon>
          <span>{{ username() }}</span>
          <mat-icon>arrow_drop_down</mat-icon>
        </button>
        <mat-menu #userMenu="matMenu">
          <button mat-menu-item disabled>
            <mat-icon>person</mat-icon>
            <span>{{ username() }}</span>
          </button>
          @if (!isAdmin() && currentUser()?.roles) {
            <button mat-menu-item disabled>
              <mat-icon>badge</mat-icon>
              <span>{{ currentUser()!.roles.join(', ') }}</span>
            </button>
          }
          <mat-divider></mat-divider>
          <button mat-menu-item (click)="logout()">
            <mat-icon>logout</mat-icon>
            <span>Cerrar sesión</span>
          </button>
        </mat-menu>
      }
    </div>
  </mat-toolbar>

  <mat-sidenav-container class="sidenav-container">
    <mat-sidenav mode="side" opened class="sidenav">
      <mat-nav-list>
        @if (isAdmin()) {
          <a mat-list-item routerLink="/users" routerLinkActive="active">Usuarios</a>
          <a mat-list-item routerLink="/organizers" routerLinkActive="active">Organizadores</a>
        }

        <!-- Opciones que requieren organizador seleccionado -->
        @if (selectedOrganizer() || !isAdmin()) {
          <a mat-list-item routerLink="/categories" routerLinkActive="active">Categorías</a>
          <a mat-list-item routerLink="/products" routerLinkActive="active">Productos</a>
          <a mat-list-item routerLink="/price-lists" routerLinkActive="active">Lista de Precios</a>
        }
      </mat-nav-list>
    </mat-sidenav>

    <mat-sidenav-content>
      <div class="content">
        <router-outlet></router-outlet>
      </div>
    </mat-sidenav-content>
  </mat-sidenav-container>
</div>

